{"ast":null,"code":"import React,{createContext,useEffect,useState}from'react';import axios from\"axios\";import{useNavigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({isLoading:false,loginUser:()=>{},logoutUser:()=>{},userToken:null,userData:null});const AuthProvider=_ref=>{let{children}=_ref;const[isLoading,setIsLoading]=useState(false);const[userToken,setUserToken]=useState(null);const[userData,setUserData]=useState(null);const navigate=useNavigate();const loginUser=async(email,password)=>{setIsLoading(true);try{const res=await axios.post(\"/login\",{email,password});const userdata=res.data;console.log(userdata);setUserData(userdata);setUserToken(userdata.access_token);localStorage.setItem('userInfo',JSON.stringify(userdata));localStorage.setItem('userToken',userdata.access_token);navigate(userdata.is_manager?'/manager-dashboard':'/dashboard');}catch(error){console.log(error);}finally{setIsLoading(false);}};const logoutUser=()=>{setUserToken(null);localStorage.removeItem('userInfo');localStorage.removeItem('userToken');setIsLoading(false);navigate(\"/\");};const isLoggedIn=async()=>{try{setIsLoading(true);const usertoken=await localStorage.getItem('userToken');const userinfo=await localStorage.getItem('userInfo');if(userinfo){setUserToken(usertoken);setUserData(JSON.parse(userinfo));}setIsLoading(false);}catch(error){console.log(\"isLogged in error \".concat(error));}};useEffect(()=>{isLoggedIn();},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isLoading,loginUser,logoutUser,userToken,userData},children:children});};export{AuthContext,AuthProvider};","map":{"version":3,"names":["React","createContext","useEffect","useState","axios","useNavigate","jsx","_jsx","AuthContext","isLoading","loginUser","logoutUser","userToken","userData","AuthProvider","_ref","children","setIsLoading","setUserToken","setUserData","navigate","email","password","res","post","userdata","data","console","log","access_token","localStorage","setItem","JSON","stringify","is_manager","error","removeItem","isLoggedIn","usertoken","getItem","userinfo","parse","concat","Provider","value"],"sources":["/home/ngare/Development/code/User-System/my-app/src/context/Authentication.tsx"],"sourcesContent":["import React, { createContext, useEffect, useState,ReactNode } from 'react';\nimport axios from \"axios\"\nimport { useNavigate } from 'react-router-dom';\n\ninterface UserData {\n  id: number;\n  username: string;\n  email: string;\n  is_manager: boolean;\n  access_token: string;\n}\n\ninterface AuthProviderProps {\n  children: ReactNode;\n}\n\ninterface AuthContextType {\n  isLoading: boolean;\n  loginUser: (email: string, password: string) => void;\n  logoutUser: () => void;\n  userToken: string | null;\n  userData: UserData | null;\n}\n\nconst AuthContext = createContext<AuthContextType>({\n  isLoading: false,\n  loginUser: () => {},\n  logoutUser: () => {},\n  userToken: null,\n  userData: null,\n});\n\nconst AuthProvider: React.FC<AuthProviderProps> = ({ children }) => {\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [userToken, setUserToken] = useState<string | null>(null)\n  const [userData, setUserData] = useState<UserData | null>(null);\n  const navigate = useNavigate();\n\n  const loginUser = async (email: string, password: string) => {\n    setIsLoading(true);\n    try {\n      const res = await axios.post(\"/login\", {\n        email,\n        password,\n      });\n      \n      const userdata: UserData = res.data;\n      console.log(userdata)\n      setUserData(userdata);\n      setUserToken(userdata.access_token);\n      \n      \n      localStorage.setItem('userInfo', JSON.stringify(userdata));\n      localStorage.setItem('userToken', userdata.access_token);\n      navigate(userdata.is_manager ? '/manager-dashboard' : '/dashboard');\n    } catch (error: any) {\n      console.log(error);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n  const logoutUser = () => {\n    setUserToken(null)\n    localStorage.removeItem('userInfo')\n    localStorage.removeItem('userToken')\n    setIsLoading(false)\n    navigate(\"/\")\n  }\n\n  const isLoggedIn = async () =>{\n    try{\n        setIsLoading(true)\n        const usertoken = await localStorage.getItem('userToken') \n        const userinfo = await localStorage.getItem('userInfo')\n        if (userinfo){\n            setUserToken(usertoken)\n            setUserData(JSON.parse(userinfo))\n        }\n        setIsLoading(false)\n    }\n    catch(error){\n        console.log(`isLogged in error ${error}`)\n    }\n  }\n\n  useEffect(() => {\n    isLoggedIn()\n  }, [])\n\n  return (\n    <AuthContext.Provider value={{ isLoading, loginUser, logoutUser, userToken, userData }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport { AuthContext, AuthProvider };\n\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,aAAa,CAAEC,SAAS,CAAEC,QAAQ,KAAkB,OAAO,CAC3E,MAAO,CAAAC,KAAK,KAAM,OAAO,CACzB,OAASC,WAAW,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAsB/C,KAAM,CAAAC,WAAW,cAAGP,aAAa,CAAkB,CACjDQ,SAAS,CAAE,KAAK,CAChBC,SAAS,CAAEA,CAAA,GAAM,CAAC,CAAC,CACnBC,UAAU,CAAEA,CAAA,GAAM,CAAC,CAAC,CACpBC,SAAS,CAAE,IAAI,CACfC,QAAQ,CAAE,IACZ,CAAC,CAAC,CAEF,KAAM,CAAAC,YAAyC,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CAC7D,KAAM,CAACN,SAAS,CAAEQ,YAAY,CAAC,CAAGd,QAAQ,CAAU,KAAK,CAAC,CAC1D,KAAM,CAACS,SAAS,CAAEM,YAAY,CAAC,CAAGf,QAAQ,CAAgB,IAAI,CAAC,CAC/D,KAAM,CAACU,QAAQ,CAAEM,WAAW,CAAC,CAAGhB,QAAQ,CAAkB,IAAI,CAAC,CAC/D,KAAM,CAAAiB,QAAQ,CAAGf,WAAW,CAAC,CAAC,CAE9B,KAAM,CAAAK,SAAS,CAAG,KAAAA,CAAOW,KAAa,CAAEC,QAAgB,GAAK,CAC3DL,YAAY,CAAC,IAAI,CAAC,CAClB,GAAI,CACF,KAAM,CAAAM,GAAG,CAAG,KAAM,CAAAnB,KAAK,CAACoB,IAAI,CAAC,QAAQ,CAAE,CACrCH,KAAK,CACLC,QACF,CAAC,CAAC,CAEF,KAAM,CAAAG,QAAkB,CAAGF,GAAG,CAACG,IAAI,CACnCC,OAAO,CAACC,GAAG,CAACH,QAAQ,CAAC,CACrBN,WAAW,CAACM,QAAQ,CAAC,CACrBP,YAAY,CAACO,QAAQ,CAACI,YAAY,CAAC,CAGnCC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAEC,IAAI,CAACC,SAAS,CAACR,QAAQ,CAAC,CAAC,CAC1DK,YAAY,CAACC,OAAO,CAAC,WAAW,CAAEN,QAAQ,CAACI,YAAY,CAAC,CACxDT,QAAQ,CAACK,QAAQ,CAACS,UAAU,CAAG,oBAAoB,CAAG,YAAY,CAAC,CACrE,CAAE,MAAOC,KAAU,CAAE,CACnBR,OAAO,CAACC,GAAG,CAACO,KAAK,CAAC,CACpB,CAAC,OAAS,CACRlB,YAAY,CAAC,KAAK,CAAC,CACrB,CACF,CAAC,CAED,KAAM,CAAAN,UAAU,CAAGA,CAAA,GAAM,CACvBO,YAAY,CAAC,IAAI,CAAC,CAClBY,YAAY,CAACM,UAAU,CAAC,UAAU,CAAC,CACnCN,YAAY,CAACM,UAAU,CAAC,WAAW,CAAC,CACpCnB,YAAY,CAAC,KAAK,CAAC,CACnBG,QAAQ,CAAC,GAAG,CAAC,CACf,CAAC,CAED,KAAM,CAAAiB,UAAU,CAAG,KAAAA,CAAA,GAAW,CAC5B,GAAG,CACCpB,YAAY,CAAC,IAAI,CAAC,CAClB,KAAM,CAAAqB,SAAS,CAAG,KAAM,CAAAR,YAAY,CAACS,OAAO,CAAC,WAAW,CAAC,CACzD,KAAM,CAAAC,QAAQ,CAAG,KAAM,CAAAV,YAAY,CAACS,OAAO,CAAC,UAAU,CAAC,CACvD,GAAIC,QAAQ,CAAC,CACTtB,YAAY,CAACoB,SAAS,CAAC,CACvBnB,WAAW,CAACa,IAAI,CAACS,KAAK,CAACD,QAAQ,CAAC,CAAC,CACrC,CACAvB,YAAY,CAAC,KAAK,CAAC,CACvB,CACA,MAAMkB,KAAK,CAAC,CACRR,OAAO,CAACC,GAAG,sBAAAc,MAAA,CAAsBP,KAAK,CAAE,CAAC,CAC7C,CACF,CAAC,CAEDjC,SAAS,CAAC,IAAM,CACdmC,UAAU,CAAC,CAAC,CACd,CAAC,CAAE,EAAE,CAAC,CAEN,mBACE9B,IAAA,CAACC,WAAW,CAACmC,QAAQ,EAACC,KAAK,CAAE,CAAEnC,SAAS,CAAEC,SAAS,CAAEC,UAAU,CAAEC,SAAS,CAAEC,QAAS,CAAE,CAAAG,QAAA,CACpFA,QAAQ,CACW,CAAC,CAE3B,CAAC,CAED,OAASR,WAAW,CAAEM,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}